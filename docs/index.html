<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Interaction with "RevBayes" in R • Revticulate</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Interaction with " revbayes in r>
<meta property="og:description" content='Interaction with "RevBayes" via R. Objects created in "RevBayes" can be passed into the R environment, and many types can be converted into similar R objects. To download "RevBayes", go to &lt;https://revbayes.github.io/download&gt;.'>
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">Revticulate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/Archery.html">Introduction to MCMC using RevBayes</a>
    </li>
    <li>
      <a href="articles/BasicTutorial.html">Usage of Revticulate</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level2">
<h2 id="revbayes-and-r">RevBayes and R<a class="anchor" aria-label="anchor" href="#revbayes-and-r"></a>
</h2>
<p>Calling external software from R can be a bit tricky, and RevBayes is no exception. In order to successfully use RevBayes in R, you must have RevBayes <a href="https://revbayes.github.io/download" class="external-link">installed</a> on your computer. You must also know the system path to the RevBayes executeable. For example, on my computer, my RevBayes executeable is called “rb” (this will be the case for Mac and Linux users), and it is stored in my software folder. If you are on PC, your copy will be called “rb.exe.”</p>
<p>In the above chunk, you will see the command <code>initRev</code>. This is a function in the <code>Revticulate</code> R package. This R package can be installed using the popular <code>devtools</code> R package like so:</p>
<pre class="{r}"><code><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/remote-reexports.html" class="external-link">install_github</a></span><span class="op">(</span><span class="st">"revbayes/Revticulate"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">Revticulate</span><span class="op">)</span>
<span class="fu">initRev</span><span class="op">(</span><span class="st">"/Users/april/software/rb"</span><span class="op">)</span>
<span class="fu">KnitRev</span><span class="op">(</span><span class="op">)</span></code></pre>
<p>The <code>initRev</code> function creates a RevBayes running environment, which will allow you to interact with RevBayes through R. <code>initRev</code> takes one argument: where RevBayes lives on your computer. Delete my sample path and enter your path above.</p>
<p>The next line, <code>KnitRev</code> establishes a KnitR environment to render Rev code in the attractive KnitR format many of us are used to.</p>
</div>
<div class="section level2">
<h2 id="using-revbayes-in-a-knitr-chunk">Using RevBayes in a KnitR Chunk<a class="anchor" aria-label="anchor" href="#using-revbayes-in-a-knitr-chunk"></a>
</h2>
<p>RevBayes can be used in a KnitR chunk by changing the header to <code>rb</code> instead of <code>r</code>. In the below chunk, we create an object called <code>example</code> and use the assignment operator to give it the value 1. Then we print it.</p>
<pre class="{rb}"><code><span class="va">example</span> <span class="op">&lt;-</span> <span class="fl">1.0</span>
<span class="va">example</span></code></pre>
<p>This is not an overtly useful thing to do, however. Let’s erase the previous chunk using the <code><a href="reference/clearRev.html">clearRev()</a></code> function. This removes prior code and objects from the RevBayes environment. Very handy if you make a mistake!</p>
<pre class="{r}"><code><span class="fu"><a href="reference/clearRev.html">clearRev</a></span><span class="op">(</span><span class="op">)</span></code></pre>
<p>We could, instead, choose to do something a little more useful. How about reading in a data matrix and making a quick starting tree?</p>
<pre class="{rb}"><code><span class="va">morpho</span> <span class="op">&lt;-</span> <span class="fu">readDiscreteCharacterData</span><span class="op">(</span><span class="st">"../data/Cinctans.nex"</span><span class="op">)</span>
<span class="va">num_taxa</span> <span class="op">&lt;-</span> <span class="fu">morpho.size</span><span class="op">(</span><span class="op">)</span>
<span class="va">num_branches</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">num_taxa</span> <span class="op">-</span> <span class="fl">2</span>
<span class="va">taxa</span> <span class="op">&lt;-</span> <span class="fu">morpho.names</span><span class="op">(</span><span class="op">)</span>
<span class="va">br_len_lambda</span> <span class="op">~</span> <span class="fu">dnExp</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>
<span class="va">phylogeny</span> <span class="op">~</span> <span class="fu">dnUniformTopologyBranchLength</span><span class="op">(</span><span class="va">taxa</span>, branchLengthDistribution<span class="op">=</span><span class="fu">dnExponential</span><span class="op">(</span><span class="va">br_len_lambda</span><span class="op">)</span><span class="op">)</span>
<span class="va">phylogeny</span></code></pre>
<p>Anything entered in an <code>rb</code> block will be interepreted as Rev code, and all the normal Rev syntax will apply. For a nice overview of Rev language and syntax, please see <a href="https://revbayes.github.io/tutorials/intro/rev" class="external-link">this tutorial</a>.</p>
<p>One thing researchers are often interested in doing is making an object in Rev and then viewing it in R. Right now, the best way to do this is to use phytools or ape to read in a RevBayes tree and plot to screen. Coercion of tree objects from RevBayes to R is still an area under active development.</p>
<pre class="{r}"><code><span class="va">phylogeny</span> <span class="op">&lt;-</span> <span class="fu">getRevObj</span><span class="op">(</span>name <span class="op">=</span> <span class="st">"phylogeny"</span>, coerce <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>

<span class="fu">phytools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/phytools/man/plotTree.html" class="external-link">plotTree</a></span><span class="op">(</span><span class="va">phylogeny</span><span class="op">)</span></code></pre>
<p>One nice facet of having RevBayes running in an R notebook is the ability to flip to visualizations of the different distributions we use. For example, here is the code for a common parameterization of the discrete Gamma distribution on site rates.</p>
<pre class="{rb}"><code><span class="va">alpha_morpho</span> <span class="op">~</span> <span class="fu">dnUniform</span><span class="op">(</span> <span class="fl">0</span>, <span class="fl">1E6</span> <span class="op">)</span>;
<span class="va">rates_morpho</span> <span class="op">:=</span> <span class="fu">fnDiscretizeGamma</span><span class="op">(</span> <span class="va">alpha_morpho</span>, <span class="va">alpha_morpho</span>, <span class="fl">4</span> <span class="op">)</span></code></pre>
<p>Might not mean much to you, in terms of what this distribution looks like. But it is important to develop intuitions for what common distributions look like. So, we can use R’s built-in graphics capabilities to have a look at what 1000 draws from this gamma will look like.</p>
<pre class="{r}"><code><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span>
<span class="va">alpha_morpho</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1E6</span> <span class="op">)</span>

<span class="va">draws</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/GammaDist.html" class="external-link">rgamma</a></span><span class="op">(</span><span class="fl">1000</span>, shape <span class="op">=</span> <span class="va">alpha_morpho</span>, rate <span class="op">=</span> <span class="va">alpha_morpho</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span></code></pre>
<div class="section level3">
<h3 id="simulate-coin-flips">Simulate coin flips<a class="anchor" aria-label="anchor" href="#simulate-coin-flips"></a>
</h3>
<p>It’s adviseable if you’re switching gears to a new activity to clear the Rev environment of workspace objects from old activities:</p>
<pre class="{r}"><code><span class="fu">ClearRev</span><span class="op">(</span><span class="op">)</span></code></pre>
<p>Note that <code>ClearRev</code> is an R function, and must be executed in an R chunk.</p>
<pre class="{rb}"><code><span class="co"># The number of coin flips</span>
<span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">100</span>

<span class="co"># The number of heads</span>
<span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">50</span></code></pre>
</div>
<div class="section level3">
<h3 id="initialize-markov-chain">Initialize Markov Chain<a class="anchor" aria-label="anchor" href="#initialize-markov-chain"></a>
</h3>
<p>We have to start MCMC off with some initial parameter values. One way to do this is to randomly draw values of the parameter (<span class="math inline"><em>p</em></span>) from the prior distribution. We assume a flat beta prior distribution (<span class="math inline"><em>α</em> = 1</span> and <span class="math inline"><em>β</em> = 1</span>).</p>
<pre class="{rb}"><code><span class="va">alpha</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">beta</span> <span class="op">&lt;-</span> <span class="fl">1</span>
<span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Beta.html" class="external-link">rbeta</a></span> <span class="op">(</span>n<span class="op">=</span><span class="fl">1</span>, <span class="va">alpha</span>, <span class="va">beta</span><span class="op">)</span> <span class="op">[</span><span class="fl">1</span><span class="op">]</span></code></pre>
</div>
<div class="section level3">
<h3 id="likelihood-function">Likelihood Function<a class="anchor" aria-label="anchor" href="#likelihood-function"></a>
</h3>
<p>We next specify the likelihood function. We use the binomial probability for the likelihood function. Since the likelihood is defined only for <span class="math inline"><em>p</em></span> between 0 and 1, we return 0 if <span class="math inline"><em>p</em></span> is outside this range.</p>
<pre class="{rb}"><code>function likelihood(p) {
    if(p &lt; 0 || p &gt; 1)
        return 0

    l = dbinomial(x,p,n,log=false)
    return l
}</code></pre>
<p>The function can then be executed in the next cell:</p>
<pre class="{rb}"><code><span class="fu">likelihood</span><span class="op">(</span><span class="va">p</span><span class="op">)</span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="the-reprev-environment">The RepRev() environment<a class="anchor" aria-label="anchor" href="#the-reprev-environment"></a>
</h2>
<p>The function <code>RepRev()</code> can be called in the console (or in non-RStudio versions of R) to use RevBayes directly to program interactively. The RepRev() environment is denoted with <code>rb&gt;&gt;&gt;</code>. To exit, type Ctrl + C.</p>
<pre class="{r}"><code><span class="fu">RepRev</span><span class="op">(</span><span class="op">)</span>

<span class="co"># rb&gt;&gt;&gt; 1+2</span>

<span class="co"># [1] 3</span></code></pre>
</div>
<div class="section level2">
<h2 id="limitations-of-revticulate">Limitations of Revticulate<a class="anchor" aria-label="anchor" href="#limitations-of-revticulate"></a>
</h2>
<p>We’re still working on object passing between RevBayes and R. So, as we saw above, passing trees from Rev to R is a little clunky. This is an area we expect to have working shortly.</p>
<p>Using Revticulate for long computations is not advisable. To run your actual MCMC, it’s probably best to save your code to a script and run it in the terminal.</p>
<p>We also have a known whitespace bug in function definition. It should be corrected over the weekend.</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=Revticulate" class="external-link">View on CRAN</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li>
<a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a>
</li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing Revticulate</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Caleb Charpentier <br><small class="roles"> Author, maintainer </small>  </li>
<li>April Wright <br><small class="roles"> Author </small>  </li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Caleb Charpentier, April Wright.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
